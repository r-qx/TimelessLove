<view class="detail-container">
  <view wx:if="{{loading}}" class="loading-state">
    <view class="loading-heart animate-breathe">ğŸ’•</view>
    <van-loading size="24px" color="#C2185B">åŠ è½½ä¸­...</van-loading>
  </view>

  <view wx:if="{{!loading && !task}}" class="empty-state">
    <text class="empty-icon">ğŸŒ™</text>
    <text class="empty-text">ä»»åŠ¡ä¸å­˜åœ¨</text>
  </view>

  <view wx:if="{{task}}" class="task-detail">
    <view class="detail-header">
      <view class="header-top">
        <view class="title-area">
          <view class="type-indicator {{task.type}}"></view>
          <text class="detail-title">{{task.title}}</text>
        </view>
        <view class="status-badge {{task.status}}">{{task.statusText}}</view>
      </view>
    </view>

    <view class="detail-card">
      <view class="card-section">
        <text class="card-label">ä»»åŠ¡æè¿°</text>
        <text class="card-value desc">{{task.description || 'æš‚æ— æè¿°'}}</text>
      </view>
      
      <view class="card-divider"></view>

      <view class="info-grid">
        <view class="grid-item">
          <text class="grid-label">ç±»å‹</text>
          <text class="grid-value">{{task.typeText}}</text>
        </view>
        <view class="grid-item">
          <text class="grid-label">éš¾åº¦</text>
          <text class="grid-value gold">â­ {{task.difficulty}}</text>
        </view>
        <view class="grid-item">
          <text class="grid-label">çˆ±å¿ƒå€¼</text>
          <text class="grid-value accent">+{{task.reward_points}}</text>
        </view>
        <view class="grid-item">
          <text class="grid-label">çˆ±æƒ…å¸</text>
          <text class="grid-value accent">+{{task.reward_coins}}</text>
        </view>
      </view>

      <view wx:if="{{task.deadline}}" class="card-divider"></view>
      <view wx:if="{{task.deadline}}" class="card-section">
        <text class="card-label">æˆªæ­¢æ—¶é—´</text>
        <text class="card-value">{{task.deadlineText}}</text>
      </view>
    </view>

    <view wx:if="{{task.status === 'completed' && task.proof}}" class="detail-card">
      <view class="card-section">
        <text class="card-section-title">å®Œæˆè¯æ˜</text>
        <text class="card-value desc">{{task.proof.content}}</text>
        <view wx:if="{{task.proof.media && task.proof.media.length > 0}}" class="proof-gallery">
          <image wx:for="{{task.proof.media}}" wx:key="index" 
                 class="proof-img" src="{{item}}" mode="aspectFill" />
        </view>
      </view>
    </view>

    <view class="action-bar">
      <van-button wx:if="{{task.status === 'pending' && !isCreator}}" 
                  round block color="#C2185B" bind:click="onApprove" loading="{{approving}}">
        åŒæ„ä»»åŠ¡
      </van-button>
      
      <van-button wx:if="{{task.status === 'approved'}}" 
                  round block color="#C2185B" bind:click="onStart" loading="{{starting}}">
        å¼€å§‹ä»»åŠ¡
      </van-button>
      
      <van-button wx:if="{{task.status === 'in_progress'}}" 
                  round block color="#C2185B" bind:click="showCompleteDialog">
        å®Œæˆä»»åŠ¡
      </van-button>
      
      <van-button wx:if="{{task.status === 'completed' && !isProofUser}}" 
                  round block color="#C2185B" bind:click="onVerify" loading="{{verifying}}">
        éªŒæ”¶ä»»åŠ¡
      </van-button>

      <view wx:if="{{task.status === 'verified'}}" class="verified-badge">
        <text class="verified-icon">âœ¨</text>
        <text class="verified-text">å·²å®Œæˆ</text>
      </view>
    </view>
  </view>

  <van-popup show="{{ showComplete }}" position="bottom" round bind:close="closeCompleteDialog"
    custom-style="background: #FEF7F0;">
    <view class="complete-popup">
      <view class="popup-header">
        <text class="popup-title">æäº¤å®Œæˆè¯æ˜</text>
        <text class="popup-subtitle">è®°å½•è¿™ä»½æˆå°±æ„Ÿ</text>
      </view>
      
      <van-field
        value="{{ completeContent }}"
        type="textarea"
        placeholder="æè¿°ä¸€ä¸‹ä»»åŠ¡å®Œæˆæƒ…å†µå§"
        maxlength="200"
        show-word-limit
        autosize
        bind:change="onCompleteContentChange"
      />

      <view class="upload-area">
        <text class="upload-label">ä¸Šä¼ å›¾ç‰‡ï¼ˆå¯é€‰ï¼‰</text>
        <view class="image-grid">
          <block wx:for="{{completeImages}}" wx:key="index">
            <view class="img-thumb">
              <image src="{{item}}" mode="aspectFill" />
              <view class="img-remove" bindtap="deleteImage" data-index="{{index}}">
                <text>Ã—</text>
              </view>
            </view>
          </block>
          <view wx:if="{{completeImages.length < 3}}" class="img-add" bindtap="chooseImage">
            <text class="add-icon">+</text>
            <text class="add-text">æ·»åŠ </text>
          </view>
        </view>
      </view>

      <view class="popup-bottom">
        <van-button round block color="#C2185B" bind:click="submitComplete" loading="{{completing}}">
          æäº¤
        </van-button>
      </view>
    </view>
  </van-popup>
</view>
